<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kemet ATS Transformer V20 ðŸ¦¾</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>

<style>
    :root { --primary:#2563eb; --dark:#0f172a; --ai:#7c3aed; --success:#10b981; --bg:#f1f5f9; }
    * { box-sizing:border-box; outline:none; }
    body { margin:0; font-family:'Inter', sans-serif; height:100vh; display:flex; background:var(--bg); overflow:hidden; }

    /* === LAYOUT === */
    .sidebar { width: 450px; background: #fff; border-right: 1px solid #ccc; display: flex; flex-direction: column; z-index: 10; box-shadow: 4px 0 20px rgba(0,0,0,0.1); }
    .main-area { flex: 1; background: #64748b; padding: 40px; display: flex; justify-content: center; overflow-y: auto; }

    /* === UPLOAD ZONE (New Feature) === */
    .upload-zone {
        background: linear-gradient(135deg, #1e293b, #334155);
        color: white; padding: 20px; text-align: center;
        border-bottom: 4px solid var(--ai);
    }
    .file-box {
        border: 2px dashed rgba(255,255,255,0.3); border-radius: 8px;
        padding: 15px; margin-top: 10px; cursor: pointer; transition: 0.3s;
        position: relative;
    }
    .file-box:hover { background: rgba(255,255,255,0.1); border-color: white; }
    .file-box input { position: absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer; }
    
    .status-badge { 
        display: inline-block; padding: 4px 10px; border-radius: 20px; 
        font-size: 11px; font-weight: bold; margin-top: 10px; display: none;
    }
    .status-good { background: #dcfce7; color: #166534; }
    .status-bad { background: #fee2e2; color: #991b1b; }

    /* === EDITOR === */
    .editor-content { padding: 20px; overflow-y: auto; flex: 1; display: flex; flex-direction: column; gap: 20px; }
    
    .section-head { font-size: 12px; font-weight: 800; text-transform: uppercase; color: #64748b; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
    input, textarea { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 13px; font-family: inherit; margin-bottom: 8px; }
    textarea { resize: vertical; min-height: 80px; }
    
    /* Smart Buttons */
    .btn-ai { background: linear-gradient(90deg, #4f46e5, #7c3aed); color: white; border: none; padding: 8px 15px; border-radius: 6px; font-size: 12px; font-weight: bold; cursor: pointer; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 4px 10px rgba(124, 58, 237, 0.3); transition: 0.2s; }
    .btn-ai:hover { transform: translateY(-2px); }
    .btn-ghost { background: transparent; border: 1px dashed #94a3b8; color: #64748b; width: 100%; padding: 8px; border-radius: 6px; cursor: pointer; }
    .btn-ghost:hover { border-color: var(--primary); color: var(--primary); }

    /* Keyword Radar */
    .kw-cloud { display: flex; flex-wrap: wrap; gap: 5px; padding: 10px; background: #eff6ff; border-radius: 8px; border: 1px solid #dbeafe; }
    .kw-tag { font-size: 10px; padding: 3px 8px; background: white; border: 1px solid #bfdbfe; border-radius: 4px; color: #1e40af; }
    .kw-matched { background: #10b981; color: white; border-color: #059669; }

    /* === PREVIEW (A4) === */
    #page { width: 210mm; min-height: 297mm; background: #fff; padding: 15mm 20mm; box-shadow: 0 0 30px rgba(0,0,0,0.4); color: #000; font-family: 'Times New Roman', serif; line-height: 1.4; }
    .cv-name { font-size: 26px; font-weight: bold; text-transform: uppercase; text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 10px; }
    .cv-contact { text-align: center; font-size: 11px; margin-bottom: 20px; }
    .cv-head { font-size: 14px; font-weight: bold; text-transform: uppercase; border-bottom: 1px solid #000; margin: 15px 0 8px 0; }
    .cv-row { display: flex; justify-content: space-between; font-weight: bold; font-size: 12px; }
    .cv-sub { font-style: italic; font-size: 12px; margin-bottom: 3px; }
    .cv-list { margin: 0; padding-left: 18px; font-size: 11px; }

    /* Loader Modal */
    .loader-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index: 1000; display: none; align-items: center; justify-content: center; flex-direction: column; color: white; }
    .spinner { width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.3); border-top-color: var(--ai); border-radius: 50%; animation: spin 1s infinite linear; margin-bottom: 15px; }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    @media print {
        body { display: block; background: #fff; }
        .sidebar, .loader-overlay { display: none; }
        .main-area { padding: 0; }
        #page { box-shadow: none; margin: 0; width: 100%; }
        @page { margin: 15mm 20mm; }
    }
</style>
</head>
<body>

<div id="loader" class="loader-overlay">
    <div class="spinner"></div>
    <div id="loaderText">AI analyzing...</div>
</div>

<div class="sidebar">
    
    <div class="upload-zone">
        <h2 style="margin:0; font-size:18px;"><i class="fa-solid fa-microchip"></i> Kemet Transformer</h2>
        <div style="font-size:11px; opacity:0.8;">Upload Old CV -> Extract Data -> AI Rewrite</div>
        
        <div class="file-box">
            <input type="file" id="pdfInput" accept=".pdf" onchange="parsePDF(this)">
            <i class="fa-solid fa-cloud-arrow-up" style="font-size:24px; margin-bottom:5px;"></i><br>
            Drop PDF CV Here to Auto-Fill
        </div>
        
        <div id="parseStatus" class="status-badge"></div>
    </div>

    <div class="editor-content">
        
        <div>
            <div class="section-head">
                <span>ðŸŽ¯ New Job Description</span>
                <span id="matchScore" style="color:var(--primary)">0% Match</span>
            </div>
            <textarea id="inJD" placeholder="Paste the NEW job description here. The AI will rewrite your old CV to match this..." oninput="analyzeKeywords()"></textarea>
            <div id="kwCloud" class="kw-cloud"></div>
        </div>

        <button class="btn-ai" onclick="transformCV()">
            <i class="fa-solid fa-wand-magic-sparkles"></i> AI Tailor CV to New Job
        </button>

        <div>
            <div class="section-head">Personal Info</div>
            <input id="inName" placeholder="Full Name" oninput="updateCV()">
            <input id="inTitle" placeholder="Job Title" oninput="updateCV()">
            <input id="inContact" placeholder="Phone | Email | LinkedIn" oninput="updateCV()">
        </div>

        <div>
            <div class="section-head">Summary</div>
            <textarea id="inSum" placeholder="Summary..." oninput="updateCV()"></textarea>
        </div>

        <div>
            <div class="section-head">Experience</div>
            <div id="expList"></div>
            <button class="btn-ghost" onclick="addExp()">+ Add Role</button>
        </div>

        <div>
            <div class="section-head">Education</div>
            <div id="eduList"></div>
            <button class="btn-ghost" onclick="addEdu()">+ Add Edu</button>
        </div>

        <div>
            <div class="section-head">Skills</div>
            <textarea id="inSkills" placeholder="Skills..." oninput="updateCV()"></textarea>
        </div>

        <button class="btn-ai" style="background:#0f172a; margin-top:10px;" onclick="window.print()">
            Download Optimized PDF
        </button>
    </div>
</div>

<div class="main-area">
    <div id="page">
        <div class="cv-name" id="outName">YOUR NAME</div>
        <div class="cv-contact" id="outContact">Contact Info</div>

        <div class="cv-head">Professional Summary</div>
        <p id="outSum" style="font-size:12px; margin:0;"></p>

        <div class="cv-head">Experience</div>
        <div id="outExp"></div>

        <div class="cv-head">Education</div>
        <div id="outEdu"></div>

        <div class="cv-head">Skills</div>
        <p id="outSkills" style="font-size:12px; margin:0;"></p>
    </div>
</div>

<script>
// Configure PDF.js Worker
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

let experiences = [];
let educations = [];
let jdKeywords = [];
let extractedText = "";

/* =========================================
   1. PDF PARSING ENGINE (Client-Side)
   ========================================= */
async function parsePDF(input) {
    const file = input.files[0];
    if (!file) return;

    showLoader("Scanning PDF structure...");
    
    try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        let fullText = "";

        // Extract text page by page
        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            const pageText = textContent.items.map(item => item.str).join(" ");
            fullText += pageText + "\n";
        }
        
        extractedText = fullText;
        
        // ATS Health Check
        const badge = document.getElementById('parseStatus');
        if(fullText.length > 100) {
            badge.className = "status-badge status-good";
            badge.style.display = "inline-block";
            badge.innerHTML = `<i class="fa-solid fa-check"></i> ATS Readable Text Detected`;
            autoFillData(fullText);
        } else {
            badge.className = "status-badge status-bad";
            badge.style.display = "inline-block";
            badge.innerHTML = `<i class="fa-solid fa-triangle-exclamation"></i> Unreadable (Likely Image/Scanned)`;
        }

    } catch (e) {
        alert("Error parsing PDF: " + e.message);
    }
    hideLoader();
}

/* =========================================
   2. INTELLIGENT AUTO-FILL (Regex)
   ========================================= */
function autoFillData(text) {
    // Basic Extraction logic
    const emailRegex = /([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/;
    const phoneRegex = /(\+?\d[\d -]{8,15}\d)/;
    
    const emailMatch = text.match(emailRegex);
    const phoneMatch = text.match(phoneRegex);
    
    if(emailMatch) document.getElementById('inName').value = "Name Detected (Verify)"; // Name is hard to extract reliably
    if(emailMatch) {
        let contact = emailMatch[0];
        if(phoneMatch) contact += " | " + phoneMatch[0];
        document.getElementById('inContact').value = contact;
    }

    // Attempt to split sections (Naive approach)
    // This is "simulated" extraction for demo. Real extraction needs complex AI models.
    document.getElementById('inSum').value = text.slice(0, 300) + "..."; 
    
    updateCV();
    alert("Data Extracted! Please review the fields.");
}

/* =========================================
   3. AI TRANSFORMATION LOGIC
   ========================================= */
function analyzeKeywords() {
    const jd = document.getElementById('inJD').value.toLowerCase();
    const cloud = document.getElementById('kwCloud');
    
    // Extract potential skills (Capitalized words or known tech terms)
    const words = jd.match(/\b[A-Z][a-zA-Z]+\b/g) || [];
    const unique = [...new Set(words)].filter(w => w.length > 3).slice(0, 10);
    jdKeywords = unique;

    cloud.innerHTML = unique.map(w => `<span class="kw-tag">${w}</span>`).join('');
    
    // Update Score
    const cvText = document.body.innerText.toLowerCase();
    let matches = unique.filter(w => cvText.includes(w.toLowerCase())).length;
    let score = Math.round((matches/unique.length)*100) || 0;
    document.getElementById('matchScore').innerText = score + "% Match";
}

function transformCV() {
    if(jdKeywords.length === 0) return alert("Please paste a New Job Description first!");
    if(experiences.length === 0 && !document.getElementById('inSum').value) return alert("Please upload or write your CV first!");

    showLoader("AI Tailoring to Job...");

    setTimeout(() => {
        // 1. Rewrite Summary
        const role = document.getElementById('inTitle').value || "Professional";
        const topKw = jdKeywords.slice(0, 3).join(", ");
        const newSum = `Adaptive ${role} with a proven history of utilizing ${topKw} to drive results. Previously ${document.getElementById('inSum').value.slice(0, 50)}...`;
        document.getElementById('inSum').value = newSum;

        // 2. Inject Keywords into Experience
        experiences.forEach((exp, i) => {
            const kw = jdKeywords[i % jdKeywords.length]; // Cycle through keywords
            if(kw) {
                exp.desc += `\nâ€¢ Leveraged ${kw} to optimize workflows and enhance project delivery.`;
            }
        });
        
        // 3. Add Missing Skills
        const currentSkills = document.getElementById('inSkills').value;
        const missing = jdKeywords.filter(k => !currentSkills.includes(k));
        if(missing.length > 0) {
            document.getElementById('inSkills').value += (currentSkills ? ", " : "") + missing.join(", ");
        }

        renderExp();
        updateCV();
        hideLoader();
        alert("Transformation Complete! Your CV is now tailored to the new job.");
    }, 2000);
}

/* =========================================
   4. CV BUILDER FUNCTIONS
   ========================================= */
function updateCV() {
    document.getElementById('outName').innerText = val('inName') || 'YOUR NAME';
    document.getElementById('outContact').innerText = val('inContact');
    document.getElementById('outSum').innerText = val('inSum');
    document.getElementById('outSkills').innerText = val('inSkills');
    analyzeKeywords();
}

function addExp() {
    experiences.push({ role:'', comp:'', date:'', desc:'' });
    renderExp();
}
function renderExp() {
    const list = document.getElementById('expList');
    list.innerHTML = experiences.map((e,i) => `
        <div style="background:#f8fafc; padding:10px; border:1px solid #cbd5e1; margin-bottom:10px; border-radius:6px; position:relative;">
            <i class="fa-solid fa-xmark" style="position:absolute; top:5px; right:5px; cursor:pointer; color:red;" onclick="experiences.splice(${i},1); renderExp(); updateCV()"></i>
            <input placeholder="Title" value="${e.role}" oninput="experiences[${i}].role=this.value; renderExpPreview()">
            <input placeholder="Company" value="${e.comp}" oninput="experiences[${i}].comp=this.value; renderExpPreview()">
            <input placeholder="Date" value="${e.date}" oninput="experiences[${i}].date=this.value; renderExpPreview()">
            <textarea placeholder="â€¢ Achievements..." oninput="experiences[${i}].desc=this.value; renderExpPreview()">${e.desc}</textarea>
        </div>
    `).join('');
    renderExpPreview();
}
function renderExpPreview() {
    document.getElementById('outExp').innerHTML = experiences.map(e => `
        <div class="cv-item">
            <div class="cv-row"><span>${e.role}</span><span>${e.date}</span></div>
            <div class="cv-sub">${e.comp}</div>
            <ul class="cv-list">${e.desc.split('\n').filter(x=>x).map(x=>`<li>${x.replace('â€¢','').trim()}</li>`).join('')}</ul>
        </div>
    `).join('');
}

function addEdu() {
    educations.push({ deg:'', school:'', date:'' });
    renderEdu();
}
function renderEdu() {
    const list = document.getElementById('eduList');
    list.innerHTML = educations.map((e,i) => `
        <div style="background:#f8fafc; padding:10px; border:1px solid #cbd5e1; margin-bottom:10px; border-radius:6px;">
            <input placeholder="Degree" value="${e.deg}" oninput="educations[${i}].deg=this.value; renderEduPreview()">
            <input placeholder="University" value="${e.school}" oninput="educations[${i}].school=this.value; renderEduPreview()">
            <input placeholder="Year" value="${e.date}" oninput="educations[${i}].date=this.value; renderEduPreview()">
        </div>
    `).join('');
    renderEduPreview();
}
function renderEduPreview() {
    document.getElementById('outEdu').innerHTML = educations.map(e => `
        <div class="cv-item">
            <div class="cv-row"><span>${e.deg}</span><span>${e.date}</span></div>
            <div class="cv-sub">${e.school}</div>
        </div>
    `).join('');
}

// Helpers
function val(id) { return document.getElementById(id).value; }
function showLoader(text) { document.getElementById('loader').style.display = 'flex'; document.getElementById('loaderText').innerText = text; }
function hideLoader() { document.getElementById('loader').style.display = 'none'; }

// Init
window.onload = function() { addExp(); addEdu(); }
</script>

</body>
                </html>
    
