<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kemet All-in-One Station</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/imagetracerjs@1.2.6/imagetracer_v1.2.6.min.js"></script>
    
    <style>
        :root { --primary: #c04000; --secondary: #2c3e50; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        
        .app-container { background: white; width: 100%; max-width: 600px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; border: 1px solid #eee; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª (Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø²Ø±ÙŠÙ†) */
        .tabs { display: flex; background: #fff; border-bottom: 2px solid #eee; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: none; font-weight: bold; color: #777; cursor: pointer; transition: 0.3s; font-size: 14px; }
        .tab-btn.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #fff5f0; }
        .tab-btn:hover { background: #fafafa; }
        
        .content-area { padding: 20px; display: none; animation: fadeIn 0.3s; }
        .content-area.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
        h3 { margin: 0 0 15px 0; color: var(--secondary); font-size: 18px; display: flex; align-items: center; gap: 8px; }
        .note { font-size: 12px; color: #888; margin-bottom: 15px; display: block; }

        /* Ø£Ø²Ø±Ø§Ø± ÙˆØ®ÙŠØ§Ø±Ø§Øª */
        .control-group { background: #fdfdfd; border: 1px solid #eee; border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        .label-title { font-weight: bold; font-size: 13px; color: #555; display: block; margin-bottom: 10px; }

        .radio-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .radio-item { position: relative; }
        .radio-item input { display: none; }
        .radio-item span { display: block; text-align: center; padding: 8px; border: 1px solid #ddd; border-radius: 8px; font-size: 13px; cursor: pointer; transition: 0.2s; font-weight: bold; color: #666; }
        .radio-item input:checked + span { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 10px rgba(192, 64, 0, 0.3); }

        /* Ø²Ø± Ø§Ù„Ø±ÙØ¹ */
        .upload-zone { position: relative; border: 2px dashed #ddd; background: #fafafa; border-radius: 12px; text-align: center; transition: 0.3s; cursor: pointer; overflow: hidden; }
        .upload-zone:hover { border-color: var(--primary); background: #fffbf8; }
        .upload-input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        .upload-content { padding: 30px 10px; pointer-events: none; }
        .upload-icon { font-size: 30px; display: block; margin-bottom: 5px; }
        .upload-text { font-weight: bold; color: #555; font-size: 15px; }

        /* Ø§Ù„ÙƒØ±ÙˆØª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ */
        .result-card { background: white; border: 1px solid #eee; border-right: 4px solid var(--primary); border-radius: 8px; padding: 12px; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .file-info { font-size: 13px; font-weight: bold; color: #333; }
        .dl-link { text-decoration: none; background: var(--secondary); color: white; padding: 6px 15px; border-radius: 20px; font-size: 12px; font-weight: bold; transition: 0.2s; }
        .dl-link:hover { background: #1a252f; transform: scale(1.05); }

        /* ShopScan Link Input */
        .url-input-group { display: flex; gap: 5px; }
        .url-input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        .fetch-btn { background: var(--secondary); color: white; border: none; padding: 0 15px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        /* Color Picker */
        #pickerPreview { width: 100%; height: 150px; object-fit: contain; background: #eee; border-radius: 8px; margin-top: 10px; display: none; }
        .color-display { margin-top: 10px; padding: 10px; background: #eee; border-radius: 8px; display: none; align-items: center; gap: 10px; font-weight: bold; }
        .color-swatch { width: 30px; height: 30px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* Toggle Switch for BG Removal */
        .toggle-switch { display: flex; align-items: center; gap: 10px; cursor: pointer; margin-top: 10px; background: #fff0f0; padding: 10px; border-radius: 8px; border: 1px solid #ffdcdc; }
        .toggle-checkbox { width: 18px; height: 18px; accent-color: red; }
        
        .loader { text-align: center; padding: 15px; color: var(--primary); font-weight: bold; display: none; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('converter')">ğŸ› ï¸ Ø§Ù„Ù…Ø­ÙˆÙ„ Ø§Ù„Ø´Ø§Ù…Ù„</button>
        <button class="tab-btn" onclick="switchTab('shopscan')">ğŸ›ï¸ Ø³Ø­Ø¨ Ù…Ù† Ø±Ø§Ø¨Ø· (ShopScan)</button>
        <button class="tab-btn" onclick="switchTab('picker')">ğŸ¨ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø£Ù„ÙˆØ§Ù†</button>
    </div>

    <div id="converter" class="content-area active">
        <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØ±Ø©</h3>
        
        <div class="control-group">
            <span class="label-title">1. Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</span>
            <div class="radio-grid">
                <label class="radio-item"><input type="radio" name="format" value="jpg" checked><span>JPG</span></label>
                <label class="radio-item"><input type="radio" name="format" value="png"><span>PNG</span></label>
                <label class="radio-item"><input type="radio" name="format" value="webp"><span>WebP</span></label>
                <label class="radio-item"><input type="radio" name="format" value="avif"><span>AVIF</span></label>
                <label class="radio-item"><input type="radio" name="format" value="svg"><span>SVG (Vector)</span></label>
                <label class="radio-item"><input type="radio" name="format" value="pdf"><span>PDF</span></label>
            </div>
        </div>

        <div class="control-group">
            <span class="label-title">2. ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:</span>
            
            <select id="blurType" style="width:100%; padding:8px; border-radius:6px; border:1px solid #ddd; margin-bottom:8px;">
                <option value="none">Ø¨Ø¯ÙˆÙ† ØªØºØ¨ÙŠØ´ (Blur)</option>
                <option value="face">ØªØºØ¨ÙŠØ´ Ø§Ù„ÙˆØ¬Ù‡ (Ø¨ÙŠØ¶Ø§ÙˆÙŠ)</option>
                <option value="bottom">ØªØºØ¨ÙŠØ´ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³ÙÙ„ÙŠ</option>
            </select>
            <input type="range" id="blurAmount" min="5" max="50" value="15" style="width:100%;">

            <label class="toggle-switch">
                <input type="checkbox" id="removeBg" class="toggle-checkbox">
                <span style="font-size:13px; color:#c0392b;">Ø­Ø°Ù Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡/Ø§Ù„Ø³Ø§Ø¯Ø© (Magic Eraser)</span>
            </label>
        </div>

        <div class="upload-zone">
            <input type="file" id="fileInput" class="upload-input" multiple accept="image/*">
            <div class="upload-content">
                <span class="upload-icon">ğŸ“‚</span>
                <span class="upload-text">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ± ÙˆØ¨Ø¯Ø¡ Ø§Ù„ØªÙ†ÙÙŠØ°</span>
            </div>
        </div>

        <div id="loader" class="loader">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„... â³</div>
        <div id="output"></div>
    </div>

    <div id="shopscan" class="content-area">
        <h3>Ø³Ø­Ø¨ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·</h3>
        <p class="note">Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø´ÙˆØ¨ÙŠÙØ§ÙŠ ÙˆØ³Ø£Ø¬Ù„Ø¨ Ù„Ùƒ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù„ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§.</p>
        
        <div class="url-input-group">
            <input type="text" id="shopUrl" class="url-input" placeholder="https://store.com/products/shirt">
            <button class="fetch-btn" onclick="fetchImage()">Ø¬Ù„Ø¨</button>
        </div>
        <div id="fetchedImageArea" style="margin-top:20px; text-align:center;"></div>
    </div>

    <div id="picker" class="content-area">
        <h3>Ø£Ø¯Ø§Ø© Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ø£Ù„ÙˆØ§Ù†</h3>
        <div class="upload-zone" style="padding:10px;">
            <input type="file" id="pickerInput" class="upload-input" accept="image/*">
            <div class="upload-content" style="padding:10px;">
                <span style="font-size:14px; font-weight:bold;">Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù„ÙˆÙ†</span>
            </div>
        </div>
        <img id="pickerPreview">
        <canvas id="pickerCanvas" style="display:none;"></canvas>
        <div id="colorResult" class="color-display">
            <div id="colorSwatch" class="color-swatch"></div>
            <span id="colorText"></span>
        </div>
    </div>

</div>

<script>
    // --- Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ---
    function switchTab(tabId) {
        document.querySelectorAll('.content-area').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø²Ø± Ø§Ù„Ù†Ø´Ø·
        event.currentTarget.classList.add('active');
    }

    // --- Ø«ÙˆØ§Ø¨Øª ---
    const MAX_WIDTH = 2048;
    const QUALITY = 0.90;
    const keywords = ["kemet", "egypt", "pharaoh", "luxor", "cairo", "ancient", "art"];

    // --- 1. Ø§Ù„Ù…Ø­ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ---
    const fileInput = document.getElementById('fileInput');
    const outputDiv = document.getElementById('output');
    const loader = document.getElementById('loader');

    fileInput.addEventListener('change', async (e) => {
        const files = Array.from(e.target.files);
        if(!files.length) return;
        
        outputDiv.innerHTML = '';
        loader.style.display = 'block';
        
        const format = document.querySelector('input[name="format"]:checked').value;
        const blurType = document.getElementById('blurType').value;
        const blurAmount = document.getElementById('blurAmount').value;
        const removeBg = document.getElementById('removeBg').checked;

        for(const file of files) {
            await processImage(file, format, blurType, blurAmount, removeBg);
        }
        loader.style.display = 'none';
        fileInput.value = '';
    });

    function processImage(file, format, blurType, blurVal, removeBg) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (e) => {
                const img = new Image();
                img.src = e.target.result;
                img.onload = () => {
                    // SVG Tracing (Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¹Ù…ÙŠÙ‚Ø©)
                    if(format === 'svg') {
                        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© ImageTracer Ù„Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (Vector)
                        const svgString = ImageTracer.imageToSVG(e.target.result, { ltres:1, qtres:1, scale:1, numberofcolors: 16 });
                        const blob = new Blob([svgString], {type: "image/svg+xml"});
                        createDownloadCard(blob, `vector-${genName()}.svg`, 'SVG (Vector)');
                        resolve();
                        return;
                    }

                    // Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© (Canvas)
                    let w = img.width, h = img.height;
                    if(w > MAX_WIDTH) { h = Math.round(h*(MAX_WIDTH/w)); w = MAX_WIDTH; }
                    
                    const canvas = document.createElement('canvas');
                    canvas.width = w; canvas.height = h;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, w, h);

                    // --- Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© (Smart Eraser) ---
                    if(removeBg) {
                        const imageData = ctx.getImageData(0, 0, w, h);
                        const data = imageData.data;
                        // Ø­Ø°Ù Ø§Ù„Ø£Ø¨ÙŠØ¶ ÙˆØ§Ù„ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹
                        for(let i=0; i<data.length; i+=4) {
                            const r = data[i], g = data[i+1], b = data[i+2];
                            if(r > 240 && g > 240 && b > 240) { data[i+3] = 0; }
                        }
                        ctx.putImageData(imageData, 0, 0);
                    }

                    // --- Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø¨Ù„ÙˆØ± ---
                    if(blurType !== 'none') {
                        ctx.save();
                        ctx.beginPath();
                        if(blurType === 'face') ctx.ellipse(w/2, h*0.35, w*0.2, h*0.25, 0, 0, 2 * Math.PI);
                        else if(blurType === 'bottom') ctx.rect(0, h*0.8, w, h*0.2);
                        ctx.clip();
                        ctx.filter = `blur(${blurVal}px)`;
                        ctx.drawImage(canvas, 0, 0); // Apply blur to self
                        ctx.restore();
                    }

                    // --- Ø§Ù„ØªØµØ¯ÙŠØ± ---
                    const seoName = genName();
                    
                    if(format === 'pdf') {
                        const { jsPDF } = window.jspdf;
                        const pdf = new jsPDF({unit:'mm', format:[w*0.26, h*0.26]});
                        pdf.addImage(canvas.toDataURL('image/jpeg'), 'JPEG', 0, 0, w*0.26, h*0.26);
                        createDownloadCard(pdf.output('blob'), `${seoName}.pdf`, 'PDF');
                        resolve();
                    } else {
                        // JPG, PNG, WebP, AVIF
                        let mime = format === 'jpg' ? 'image/jpeg' : `image/${format}`;
                        canvas.toBlob(blob => {
                            createDownloadCard(blob, `${seoName}.${format}`, format.toUpperCase());
                            resolve();
                        }, mime, QUALITY);
                    }
                };
            };
        });
    }

    // --- 2. Ù…ÙŠØ²Ø© ShopScan (Fetch) ---
    function fetchImage() {
        const url = document.getElementById('shopUrl').value;
        if(!url) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙˆØ¶Ø¹ Ø±Ø§Ø¨Ø·');
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© (Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ù…ØªØµÙØ­ CORSØŒ Ø³Ù†Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¬ÙŠÙ‡ÙŠØ© Ø£Ùˆ Ù†ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©)
        const demoArea = document.getElementById('fetchedImageArea');
        demoArea.innerHTML = `<p style="color:red; font-size:12px;">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¨Ø³Ø¨Ø¨ Ù‚ÙŠÙˆØ¯ Ø£Ù…Ø§Ù† Ø§Ù„Ù…ØªØµÙØ­Ø§Øª (CORS)ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ù‡Ù†Ø§ Ø¨Ø¯ÙˆÙ† Ø³ÙŠØ±ÙØ±. Ù„ÙƒÙ† ÙƒØ­Ù„ Ø¨Ø¯ÙŠÙ„: Ø£Ø¶Ù <b>.jpg</b> ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§ÙØªØ­Ù‡.</p> <a href="${url}.jpg" target="_blank" class="dl-link">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ÙØªØ­ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£ØµÙ„ÙŠØ©</a>`;
    }

    // --- 3. Ù„Ø§Ù‚Ø· Ø§Ù„Ø£Ù„ÙˆØ§Ù† ---
    const pickerInput = document.getElementById('pickerInput');
    const pickPrev = document.getElementById('pickerPreview');
    const pickCanvas = document.getElementById('pickerCanvas');
    const pickCtx = pickCanvas.getContext('2d');

    pickerInput.addEventListener('change', (e) => {
        if(e.target.files[0]) {
            const r = new FileReader();
            r.onload = (ev) => { pickPrev.src = ev.target.result; pickPrev.style.display='block'; };
            r.readAsDataURL(e.target.files[0]);
        }
    });

    pickPrev.onload = () => { pickCanvas.width = pickPrev.naturalWidth; pickCanvas.height = pickPrev.naturalHeight; pickCtx.drawImage(pickPrev, 0, 0); };
    
    pickPrev.addEventListener('click', (e) => {
        const rect = pickPrev.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (pickPrev.naturalWidth / rect.width);
        const y = (e.clientY - rect.top) * (pickPrev.naturalHeight / rect.height);
        const p = pickCtx.getImageData(x, y, 1, 1).data;
        const hex = "#" + ((1<<24)+(p[0]<<16)+(p[1]<<8)+p[2]).toString(16).slice(1).toUpperCase();
        
        document.getElementById('colorResult').style.display = 'flex';
        document.getElementById('colorSwatch').style.background = hex;
        document.getElementById('colorText').innerText = hex;
    });

    // --- Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ---
    function genName() {
        return `kemet-${keywords[Math.floor(Math.random()*keywords.length)]}-${Math.floor(Math.random()*1000)}`;
    }

    function createDownloadCard(blob, name, label) {
        const url = URL.createObjectURL(blob);
        const div = document.createElement('div');
        div.className = 'result-card';
        div.innerHTML = `
            <div class="file-info">${name} <br> <span style="font-weight:normal; font-size:11px; color:#777;">${(blob.size/1024).toFixed(1)} KB</span></div>
            <a href="${url}" download="${name}" class="dl-link">ØªØ­Ù…ÙŠÙ„ ${label} â¬‡</a>
        `;
        document.getElementById('output').appendChild(div);
    }
</script>

</body>
    </html>
                    
