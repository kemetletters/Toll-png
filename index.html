<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kemet Ultimate Tool V7</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #fdf8f0; padding: 15px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; }
        .main-container { width: 100%; max-width: 650px; display: flex; flex-direction: column; gap: 20px; }
        
        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ø© */
        .section-box { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 15px rgba(139, 69, 19, 0.08); border: 1px solid #e3d0b9; text-align: center; }
        h2 { color: #8b4513; margin-top: 0; font-size: 22px; margin-bottom: 5px; }
        p { color: #795548; font-size: 13px; margin-bottom: 20px; }
        
        /* Ù„Ø§Ù‚Ø· Ø§Ù„Ø£Ù„ÙˆØ§Ù† */
        .color-picker-box { border: 2px dashed #8b4513; background: #fffaf5; }
        .picker-btn { background: #795548; color: white; padding: 8px 15px; border-radius: 6px; cursor: pointer; display: inline-block; font-size: 14px; }
        #imagePreviewContainer { margin-top: 10px; max-height: 200px; overflow: hidden; display: none; }
        #imagePreview { max-width: 100%; max-height: 200px; cursor: crosshair; }
        .color-res { margin-top: 10px; padding: 5px; background: #eee; display: none; justify-content: center; gap: 10px; align-items: center; border-radius: 5px; }
        .c-box { width: 20px; height: 20px; border-radius: 50%; border: 1px solid #fff; }

        /* Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¨Ù„ÙˆØ± ÙˆØ§Ù„ØµÙŠØº */
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: right; margin-bottom: 20px; }
        .option-group { background: #fff8f0; padding: 10px; border-radius: 10px; border: 1px solid #ebdccb; }
        .opt-title { font-weight: bold; font-size: 13px; color: #5d4037; display: block; margin-bottom: 8px; }
        
        select, input[type="range"] { width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc; background: white; }
        
        .radio-group { display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; }
        .radio-label { font-size: 12px; padding: 5px 10px; background: white; border: 1px solid #ddd; border-radius: 15px; cursor: pointer; }
        .radio-label input { margin-left: 5px; }
        .radio-label:hover { border-color: #c04000; }

        /* Ø²Ø± Ø§Ù„Ø±ÙØ¹ ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ */
        .upload-wrapper { position: relative; margin-top: 10px; }
        .upload-btn { background: linear-gradient(135deg, #c04000 0%, #a03500 100%); color: white; padding: 15px; border-radius: 10px; font-weight: bold; width: 100%; border: none; font-size: 16px; cursor: pointer; }
        input[type="file"] { position: absolute; left: 0; top: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }

        .card { background: #fff; border: 1px solid #eee; border-left: 5px solid #c04000; border-radius: 8px; padding: 10px; margin-top: 10px; text-align: right; }
        .dl-btn { display: block; padding: 10px; margin-top: 5px; text-align: center; text-decoration: none; border-radius: 6px; font-size: 14px; font-weight: bold; }
        
        /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn-jpg { background: #e3f2fd; color: #1565c0; } .btn-png { background: #ede7f6; color: #673ab7; }
        .btn-webp { background: #e8f5e9; color: #2e7d32; } .btn-avif { background: #fce4ec; color: #c2185b; }
        .btn-pdf { background: #ffebee; color: #c62828; } .btn-svg { background: #fff8e1; color: #f57f17; }
        
        .loader { display: none; font-weight: bold; color: #c04000; margin-top: 10px; }
    </style>
</head>
<body>

<div class="main-container">

    <div class="section-box color-picker-box">
        <span style="font-weight:bold; color:#8b4513;">ğŸ¨ Ø£Ø¯Ø§Ø© Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø£Ù„ÙˆØ§Ù†</span>
        <div style="margin-top:10px;">
            <label class="picker-btn">Ø±ÙØ¹ ØµÙˆØ±Ø© ğŸ“‚<input type="file" id="pickerInput" accept="image/*" style="display:none;"></label>
        </div>
        <div id="imagePreviewContainer"><img id="imagePreview"><canvas id="pickerCanvas" style="display:none;"></canvas></div>
        <div id="colorResult" class="color-res"><div id="colorBox" class="c-box"></div><span id="colorHex"></span></div>
    </div>

    <div class="section-box">
        <h2>Kemet Pro V7 ğŸ›ï¸</h2>
        <p>ØªØ­ÙˆÙŠÙ„ + SEO + Ø¹Ø²Ù„ (Blur) ÙÙŠ Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø©</p>

        <div class="options-grid">
            <div class="option-group">
                <span class="opt-title">1. ØµÙŠØºØ© Ø§Ù„Ù…Ù„Ù:</span>
                <div class="radio-group">
                    <label class="radio-label"><input type="radio" name="format" value="jpg" checked> JPG</label>
                    <label class="radio-label"><input type="radio" name="format" value="png"> PNG</label>
                    <label class="radio-label"><input type="radio" name="format" value="webp"> WebP</label>
                    <label class="radio-label"><input type="radio" name="format" value="avif"> AVIF</label>
                    <label class="radio-label"><input type="radio" name="format" value="pdf"> PDF</label>
                    <label class="radio-label"><input type="radio" name="format" value="svg"> SVG</label>
                </div>
            </div>

            <div class="option-group">
                <span class="opt-title">2. Ø¥Ø¶Ø§ÙØ© Ø¨Ù„ÙˆØ± (ØªØºØ¨ÙŠØ´):</span>
                <select id="blurType">
                    <option value="none">Ø¨Ø¯ÙˆÙ† (Ù„Ø§ Ø´ÙŠØ¡)</option>
                    <option value="face">Ø§Ù„ÙˆØ¬Ù‡ (ØªÙ‚Ø±ÙŠØ¨ÙŠ/Ù…Ù†ØªØµÙ Ø¹Ù„ÙˆÙŠ)</option>
                    <option value="top">Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ø¥Ø®ÙØ§Ø¡ Ø±Ø£Ø³)</option>
                    <option value="bottom">Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³ÙÙ„ÙŠ (Ø¥Ø®ÙØ§Ø¡ Ù‚Ø¯Ù…/Ù†Øµ)</option>
                    <option value="center">Ù…Ù†ØªØµÙ Ø§Ù„ØµÙˆØ±Ø©</option>
                </select>
                <div style="margin-top:5px;">
                    <span class="opt-title" style="display:inline;">Ø§Ù„Ù‚ÙˆØ©:</span>
                    <input type="range" id="blurAmount" min="5" max="50" value="15" style="width:60%; vertical-align:middle;">
                </div>
            </div>
        </div>

        <div class="upload-wrapper">
            <button class="upload-btn">3. Ø§Ø®ØªØ± Ø§Ù„ØµÙˆØ± ÙˆÙ†ÙØ° Ø§Ù„ÙƒÙ„ ğŸš€</button>
            <input type="file" id="fileInput" multiple accept="image/*">
        </div>

        <div id="loader" class="loader">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</div>
        <div id="output"></div>
    </div>
</div>

<script>
    // --- Ù…ØªØºÙŠØ±Ø§Øª ÙˆÙ‚ÙˆØ§Ù…ÙŠØ³ ---
    const MAX_WIDTH = 2048;
    const QUALITY = 0.90;
    const seoKeywords = ["ancient-egypt", "pharaohs", "kemet", "egyptian-art", "pyramids", "sphinx", "nile", "tutankhamun", "nefertiti", "luxor", "karnak", "ramses", "hieroglyphs", "lotus", "ankh", "horus", "anubis", "ra-god"];

    // --- 1. Ù…Ù†Ø·Ù‚ Ù„Ø§Ù‚Ø· Ø§Ù„Ø£Ù„ÙˆØ§Ù† ---
    const pickerInput = document.getElementById('pickerInput');
    const imgPrev = document.getElementById('imagePreview');
    const pickCanvas = document.getElementById('pickerCanvas');
    const pickCtx = pickCanvas.getContext('2d');
    
    pickerInput.addEventListener('change', (e) => {
        if(e.target.files[0]) {
            const reader = new FileReader();
            reader.onload = (ev) => { imgPrev.src = ev.target.result; document.getElementById('imagePreviewContainer').style.display='block'; document.getElementById('colorResult').style.display='none'; };
            reader.readAsDataURL(e.target.files[0]);
        }
    });
    imgPrev.onload = () => { pickCanvas.width = imgPrev.naturalWidth; pickCanvas.height = imgPrev.naturalHeight; pickCtx.drawImage(imgPrev, 0, 0); };
    imgPrev.addEventListener('click', (e) => {
        const rect = imgPrev.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (imgPrev.naturalWidth / rect.width);
        const y = (e.clientY - rect.top) * (imgPrev.naturalHeight / rect.height);
        const p = pickCtx.getImageData(x, y, 1, 1).data;
        const hex = "#" + ((1<<24)+(p[0]<<16)+(p[1]<<8)+p[2]).toString(16).slice(1).toUpperCase();
        document.getElementById('colorBox').style.background = hex;
        document.getElementById('colorHex').innerText = hex + ` (RGB: ${p[0]},${p[1]},${p[2]})`;
        document.getElementById('colorResult').style.display = 'flex';
    });

    // --- 2. Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ÙˆØ§Ù„Ø¨Ù„ÙˆØ± ---
    const fileInput = document.getElementById('fileInput');
    const outputDiv = document.getElementById('output');
    const loader = document.getElementById('loader');

    fileInput.addEventListener('change', async (e) => {
        outputDiv.innerHTML = '';
        const files = Array.from(e.target.files);
        if(!files.length) return;
        
        loader.style.display = 'block';
        const format = document.querySelector('input[name="format"]:checked').value;
        const blurType = document.getElementById('blurType').value;
        const blurAmount = document.getElementById('blurAmount').value;

        for (const file of files) {
            try { await processImage(file, format, blurType, blurAmount); } catch(err) { console.error(err); }
        }
        loader.style.display = 'none';
        fileInput.value = '';
    });

    function processImage(file, format, blurType, blurVal) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (ev) => {
                const img = new Image();
                img.src = ev.target.result;
                img.onload = () => {
                    let w = img.width, h = img.height;
                    // ØªØ­Ø¬ÙŠÙ…
                    if (w > MAX_WIDTH) { h = Math.round(h * (MAX_WIDTH/w)); w = MAX_WIDTH; }
                    
                    const canvas = document.createElement('canvas');
                    canvas.width = w; canvas.height = h;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, w, h);

                    // === ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ù„ÙˆØ± (Blur Logic) ===
                    if(blurType !== 'none') {
                        ctx.save(); // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø©
                        ctx.beginPath();
                        
                        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
                        if (blurType === 'top') ctx.rect(0, 0, w, h * 0.25); // Ø±Ø¨Ø¹ Ø¹Ù„ÙˆÙŠ
                        else if (blurType === 'bottom') ctx.rect(0, h * 0.75, w, h * 0.25); // Ø±Ø¨Ø¹ Ø³ÙÙ„ÙŠ
                        else if (blurType === 'center') ctx.rect(w*0.25, h*0.25, w*0.5, h*0.5); // Ù…Ø±Ø¨Ø¹ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
                        else if (blurType === 'face') ctx.ellipse(w/2, h*0.35, w*0.2, h*0.25, 0, 0, 2 * Math.PI); // Ø´ÙƒÙ„ Ø¨ÙŠØ¶Ø§ÙˆÙŠ ÙÙŠ Ù…ÙƒØ§Ù† Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹

                        ctx.clip(); // Ù‚Øµ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù„Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„ÙŠÙ‡Ø§ ÙÙ‚Ø·
                        ctx.filter = `blur(${blurVal}px)`;
                        ctx.drawImage(img, 0, 0, w, h); // Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ (Ø³ØªØ¸Ù‡Ø± Ù…Ø´ÙˆØ´Ø© ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ù‚ØµÙˆØµØ© ÙÙ‚Ø·)
                        ctx.restore(); // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø©
                    }

                    // === Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ ===
                    const seoName = `kemet-${seoKeywords[Math.floor(Math.random()*seoKeywords.length)]}-${Math.floor(Math.random()*1000)}`;
                    const card = document.createElement('div'); card.className = 'card';
                    const nameSpan = document.createElement('div'); nameSpan.style.fontWeight='bold'; nameSpan.innerText = seoName;
                    card.appendChild(nameSpan);

                    if (['jpg','png','webp','avif'].includes(format)) {
                        let mime = format==='jpg'?'image/jpeg':`image/${format}`;
                        canvas.toBlob(blob => {
                            if(blob) createBtn(blob, `${seoName}.${format}`, format, card);
                            resolve();
                        }, mime, QUALITY);
                    } else if (format === 'pdf') {
                        const { jsPDF } = window.jspdf;
                        const pdf = new jsPDF({ unit:'mm', format:[w*0.26, h*0.26] });
                        pdf.addImage(canvas.toDataURL('image/jpeg', QUALITY), 'JPEG', 0, 0, w*0.26, h*0.26);
                        createBtn(pdf.output('blob'), `${seoName}.pdf`, 'pdf', card);
                        resolve();
                    } else if (format === 'svg') {
                        const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${w}" height="${h}"><image href="${canvas.toDataURL('image/jpeg',QUALITY)}" width="${w}" height="${h}"/></svg>`;
                        createBtn(new Blob([svg],{type:"image/svg+xml"}), `${seoName}.svg`, 'svg', card);
                        resolve();
                    }
                    outputDiv.appendChild(card);
                };
            };
        });
    }

    function createBtn(blob, name, type, parent) {
        const url = URL.createObjectURL(blob);
        const btn = document.createElement('a');
        btn.href = url; btn.download = name; btn.className = `dl-btn btn-${type}`;
        btn.innerHTML = `ØªØ­Ù…ÙŠÙ„ ${type.toUpperCase()} ğŸ“¥ (${(blob.size/1024).toFixed(1)} KB)`;
        parent.appendChild(btn);
    }
</script>

</body>
</html>
